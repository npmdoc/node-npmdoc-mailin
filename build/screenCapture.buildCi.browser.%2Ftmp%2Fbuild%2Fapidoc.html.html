<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/Flolagale/mailin">mailin (v3.0.4)</a>
</h1>
<h4>Artisanal inbound emails for every web app</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin">module mailin</a><ol>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">mailin.</span>_eventsCount</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>_events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>_smtp</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>_smtp._events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>_smtp.logger</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>_smtp.options</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>configuration</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>domain</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>logger</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.</span>mailUtilities</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin._smtp">module mailin._smtp</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin._smtp.</span>_closeTimeout</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.onAuth">
            function <span class="apidocSignatureSpan">mailin._smtp.</span>onAuth
            <span class="apidocSignatureSpan">(auth, session, streamCallback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.onData">
            function <span class="apidocSignatureSpan">mailin._smtp.</span>onData
            <span class="apidocSignatureSpan">(stream, session, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.onMailFrom">
            function <span class="apidocSignatureSpan">mailin._smtp.</span>onMailFrom
            <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.onRcptTo">
            function <span class="apidocSignatureSpan">mailin._smtp.</span>onRcptTo
            <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">mailin._smtp.</span>_eventsCount</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>_events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>connections</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>domain</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>logger</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>options</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>secureContext</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.</span>server</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin._smtp._events">module mailin._smtp._events</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp._events.close">
            function <span class="apidocSignatureSpan">mailin._smtp._events.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp._events.error">
            function <span class="apidocSignatureSpan">mailin._smtp._events.</span>error
            <span class="apidocSignatureSpan">(error)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin._smtp.logger">module mailin._smtp.logger</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.logger.debug">
            function <span class="apidocSignatureSpan">mailin._smtp.logger.</span>debug
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.logger.error">
            function <span class="apidocSignatureSpan">mailin._smtp.logger.</span>error
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.logger.info">
            function <span class="apidocSignatureSpan">mailin._smtp.logger.</span>info
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin._smtp.options">module mailin._smtp.options</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin._smtp.options.</span>logger</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin._smtp.options.</span>secure</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.options.onAuth">
            function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onAuth
            <span class="apidocSignatureSpan">(auth, session, streamCallback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.options.onData">
            function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onData
            <span class="apidocSignatureSpan">(stream, session, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.options.onMailFrom">
            function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onMailFrom
            <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin._smtp.options.onRcptTo">
            function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onRcptTo
            <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.options.</span>authMethods</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin._smtp.options.</span>disabledCommands</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">mailin._smtp.options.</span>banner</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin.logger">module mailin.logger</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin.logger.</span>emitErrs</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin.logger.</span>exitOnError</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin.logger.</span>padLevels</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">mailin.logger.</span>stripColors</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger._error">
            function <span class="apidocSignatureSpan">mailin.logger.</span>_error
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.debug">
            function <span class="apidocSignatureSpan">mailin.logger.</span>debug
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.error">
            function <span class="apidocSignatureSpan">mailin.logger.</span>error
            <span class="apidocSignatureSpan">(err)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.info">
            function <span class="apidocSignatureSpan">mailin.logger.</span>info
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.setLevel">
            function <span class="apidocSignatureSpan">mailin.logger.</span>setLevel
            <span class="apidocSignatureSpan">(level)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.setLogFile">
            function <span class="apidocSignatureSpan">mailin.logger.</span>setLogFile
            <span class="apidocSignatureSpan">(logFilePath)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.silly">
            function <span class="apidocSignatureSpan">mailin.logger.</span>silly
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.verbose">
            function <span class="apidocSignatureSpan">mailin.logger.</span>verbose
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.logger.warn">
            function <span class="apidocSignatureSpan">mailin.logger.</span>warn
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">mailin.logger.</span>_eventsCount</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>_events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>_hnames</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>_names</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>domain</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>exceptionHandlers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>filters</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>levels</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>profilers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>rewriters</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailin.logger.</span>transports</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">mailin.logger.</span>level</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailin.mailUtilities">module mailin.mailUtilities</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.mailUtilities.computeSpamScore">
            function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>computeSpamScore
            <span class="apidocSignatureSpan">(rawEmail, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.mailUtilities.computeSpamScoreAsync">
            function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>computeSpamScoreAsync
            <span class="apidocSignatureSpan">(_arg0, _arg1, _arg2)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.mailUtilities.validateDkim">
            function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateDkim
            <span class="apidocSignatureSpan">(rawEmail, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.mailUtilities.validateDkimAsync">
            function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateDkimAsync
            <span class="apidocSignatureSpan">(_arg0, _arg1, _arg2)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.mailUtilities.validateSpf">
            function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateSpf
            <span class="apidocSignatureSpan">(ip, address, host, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailin.mailUtilities.validateSpfAsync">
            function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateSpfAsync
            <span class="apidocSignatureSpan">(_arg0, _arg1, _arg2)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin" id="apidoc.module.mailin">module mailin</a></h1>





















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin._smtp" id="apidoc.module.mailin._smtp">module mailin._smtp</a></h1>




    <h2>
        <a href="#apidoc.element.mailin._smtp.onAuth" id="apidoc.element.mailin._smtp.onAuth">
        function <span class="apidocSignatureSpan">mailin._smtp.</span>onAuth
        <span class="apidocSignatureSpan">(auth, session, streamCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onAuth(auth, session, streamCallback) {
    if (_this.emit('authorizeUser', session, auth.username, auth.password, streamCallback)) {
        streamCallback(new Error('Unauthorized user'));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.onData" id="apidoc.element.mailin._smtp.onData">
        function <span class="apidocSignatureSpan">mailin._smtp.</span>onData
        <span class="apidocSignatureSpan">(stream, session, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onData(stream, session, callback) {
    _session = session;
    var connection = _.cloneDeep(session);
    connection.id = uuid.v4();
    var mailPath = path.join(configuration.tmp, connection.id);
    connection.mailPath = mailPath;

    _this.emit('startData', connection);
    logger.verbose('Connection id ' + connection.id);
    logger.info(connection.id + ' Receiving message from ' + connection.envelope.mailFrom.address);

    _this.emit('startMessage', connection);

    stream.pipe(fs.createWriteStream(mailPath));

    stream.on('data', function (chunk) {
        _this.emit('data', connection, chunk);
    });

    stream.on('end', function () {
        dataReady(connection);
        callback();
    });

    stream.on('close', function () {
        _this.emit('close', connection);
    });

    stream.on('error', function (error) {
        _this.emit('error', connection, error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.onMailFrom" id="apidoc.element.mailin._smtp.onMailFrom">
        function <span class="apidocSignatureSpan">mailin._smtp.</span>onMailFrom
        <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onMailFrom(address, session, streamCallback) {
    _this.emit('validateSender', session, address.address, streamCallback);
    var ack = function (err) {
        streamCallback(err);
    };
    validateAddress('sender', address.address, session.envelope)
        .then(ack)
        .catch(ack);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.onRcptTo" id="apidoc.element.mailin._smtp.onRcptTo">
        function <span class="apidocSignatureSpan">mailin._smtp.</span>onRcptTo
        <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onRcptTo(address, session, streamCallback) {
    var ack = function (err) {
        streamCallback(err);
    };
    _this.emit('validateRecipient', session, address.address, callback);
    validateAddress('recipient', address.address, session.envelope)
        .then(ack)
        .catch(ack);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin._smtp._events" id="apidoc.module.mailin._smtp._events">module mailin._smtp._events</a></h1>


    <h2>
        <a href="#apidoc.element.mailin._smtp._events.close" id="apidoc.element.mailin._smtp._events.close">
        function <span class="apidocSignatureSpan">mailin._smtp._events.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
    logger.info('Closing smtp server');
    _this.emit('close', _session);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Mailin.prototype.stop = function (callback) {
callback = callback || function () {};
logger.info('Stopping mailin.');

/* FIXME A bug in the RAI module prevents the callback to be called, so
 * call end and call the callback directly. */
this._smtp.<span class="apidocCodeKeywordSpan">close</span>(callback);
callback();
};

Mailin.prototype._convertTextToHtml = function (text) {
/* Replace newlines by &lt;br&gt;. */
text = text.replace(/(\n\r)|(\n)/g, '&lt;br&gt;');
/* Remove &lt;br&gt; at the begining. */
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp._events.error" id="apidoc.element.mailin._smtp._events.error">
        function <span class="apidocSignatureSpan">mailin._smtp._events.</span>error
        <span class="apidocSignatureSpan">(error)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">error = function (error) {
    logger.error(error);
    _this.emit('error', _session, error);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var logger = require('./lib/logger');
var mailin = require('./index');
var program = require('commander');

function collectOptions(keyValue, options) {
    if (!keyValue || keyValue.indexOf(':') &lt; 0) {
        logger.<span class="apidocCodeKeywordSpan">error</span>('Ignoring option '  + keyValue);
        return options;
    }
    options = options || {};
    var split = keyValue.split(':');
    options[split[0]] = split[1];
    return options;
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin._smtp.logger" id="apidoc.module.mailin._smtp.logger">module mailin._smtp.logger</a></h1>


    <h2>
        <a href="#apidoc.element.mailin._smtp.logger.debug" id="apidoc.element.mailin._smtp.logger.debug">
        function <span class="apidocSignatureSpan">mailin._smtp.logger.</span>debug
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var attachmentNamesAndContent = {};
finalizedMessage.attachments.forEach(function (attachment) {
    attachmentNamesAndContent[attachment.generatedFileName] = (attachment.content || Buffer('')).toString('base64
');
    delete attachment.content;
});
logger.profile('Convert attachments to strings');

logger.<span class="apidocCodeKeywordSpan">debug</span>(finalizedMessage);

var req = request.post(configuration.webhook);
req.field('mailinMsg', JSON.stringify(finalizedMessage));

_.forEach(attachmentNamesAndContent, function (content, name) {
    req.field(name, content);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.logger.error" id="apidoc.element.mailin._smtp.logger.error">
        function <span class="apidocSignatureSpan">mailin._smtp.logger.</span>error
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">error = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var logger = require('./lib/logger');
var mailin = require('./index');
var program = require('commander');

function collectOptions(keyValue, options) {
    if (!keyValue || keyValue.indexOf(':') &lt; 0) {
        logger.<span class="apidocCodeKeywordSpan">error</span>('Ignoring option '  + keyValue);
        return options;
    }
    options = options || {};
    var split = keyValue.split(':');
    options[split[0]] = split[1];
    return options;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.logger.info" id="apidoc.element.mailin._smtp.logger.info">
        function <span class="apidocSignatureSpan">mailin._smtp.logger.</span>info
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">info = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
.option('--smtp [value]', 'smtp options split with :, check https://github.com/andris9/smtp-server/tree/v1.4.0'
;, collectOptions, {});

/* Hack the argv object so that commander thinks that this script is called
 * 'mailin'. The help info will look nicer. */
process.argv[1] = 'mailin';
program.parse(process.argv);

logger.<span class="apidocCodeKeywordSpan">info</span>('Mailin v' + pkg.version);

var smtpOptions = program.smtp;
smtpOptions.disabledCommands = program.disabledSmtpCommands;

mailin.start({
port: program.port || 25,
host: program.host || '0.0.0.0',
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin._smtp.options" id="apidoc.module.mailin._smtp.options">module mailin._smtp.options</a></h1>






    <h2>
        <a href="#apidoc.element.mailin._smtp.options.onAuth" id="apidoc.element.mailin._smtp.options.onAuth">
        function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onAuth
        <span class="apidocSignatureSpan">(auth, session, streamCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onAuth(auth, session, streamCallback) {
    if (_this.emit('authorizeUser', session, auth.username, auth.password, streamCallback)) {
        streamCallback(new Error('Unauthorized user'));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.options.onData" id="apidoc.element.mailin._smtp.options.onData">
        function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onData
        <span class="apidocSignatureSpan">(stream, session, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onData(stream, session, callback) {
    _session = session;
    var connection = _.cloneDeep(session);
    connection.id = uuid.v4();
    var mailPath = path.join(configuration.tmp, connection.id);
    connection.mailPath = mailPath;

    _this.emit('startData', connection);
    logger.verbose('Connection id ' + connection.id);
    logger.info(connection.id + ' Receiving message from ' + connection.envelope.mailFrom.address);

    _this.emit('startMessage', connection);

    stream.pipe(fs.createWriteStream(mailPath));

    stream.on('data', function (chunk) {
        _this.emit('data', connection, chunk);
    });

    stream.on('end', function () {
        dataReady(connection);
        callback();
    });

    stream.on('close', function () {
        _this.emit('close', connection);
    });

    stream.on('error', function (error) {
        _this.emit('error', connection, error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.options.onMailFrom" id="apidoc.element.mailin._smtp.options.onMailFrom">
        function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onMailFrom
        <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onMailFrom(address, session, streamCallback) {
    _this.emit('validateSender', session, address.address, streamCallback);
    var ack = function (err) {
        streamCallback(err);
    };
    validateAddress('sender', address.address, session.envelope)
        .then(ack)
        .catch(ack);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin._smtp.options.onRcptTo" id="apidoc.element.mailin._smtp.options.onRcptTo">
        function <span class="apidocSignatureSpan">mailin._smtp.options.</span>onRcptTo
        <span class="apidocSignatureSpan">(address, session, streamCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onRcptTo(address, session, streamCallback) {
    var ack = function (err) {
        streamCallback(err);
    };
    _this.emit('validateRecipient', session, address.address, callback);
    validateAddress('recipient', address.address, session.envelope)
        .then(ack)
        .catch(ack);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin.logger" id="apidoc.module.mailin.logger">module mailin.logger</a></h1>










    <h2>
        <a href="#apidoc.element.mailin.logger._error" id="apidoc.element.mailin.logger._error">
        function <span class="apidocSignatureSpan">mailin.logger.</span>_error
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_error = function (msg) {
  // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])
  var args = [level].concat(Array.prototype.slice.call(arguments));
  target.log.apply(target, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (logger.transports.file) logger.transports.file.level = level;
}
};

logger._error = logger.error;
logger.error = function (err) {
if (err.stack) {
    this.<span class="apidocCodeKeywordSpan">_error</span>(err.stack);
} else if (!_.isString(err)) {
    this._error(util.inspect(err, {
        depth: 5
    }));
} else {
    this._error.apply(this, arguments);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.debug" id="apidoc.element.mailin.logger.debug">
        function <span class="apidocSignatureSpan">mailin.logger.</span>debug
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (msg) {
  // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])
  var args = [level].concat(Array.prototype.slice.call(arguments));
  target.log.apply(target, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var attachmentNamesAndContent = {};
finalizedMessage.attachments.forEach(function (attachment) {
    attachmentNamesAndContent[attachment.generatedFileName] = (attachment.content || Buffer('')).toString('base64
');
    delete attachment.content;
});
logger.profile('Convert attachments to strings');

logger.<span class="apidocCodeKeywordSpan">debug</span>(finalizedMessage);

var req = request.post(configuration.webhook);
req.field('mailinMsg', JSON.stringify(finalizedMessage));

_.forEach(attachmentNamesAndContent, function (content, name) {
    req.field(name, content);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.error" id="apidoc.element.mailin.logger.error">
        function <span class="apidocSignatureSpan">mailin.logger.</span>error
        <span class="apidocSignatureSpan">(err)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">error = function (err) {
    if (err.stack) {
        this._error(err.stack);
    } else if (!_.isString(err)) {
        this._error(util.inspect(err, {
            depth: 5
        }));
    } else {
        this._error.apply(this, arguments);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var logger = require('./lib/logger');
var mailin = require('./index');
var program = require('commander');

function collectOptions(keyValue, options) {
    if (!keyValue || keyValue.indexOf(':') &lt; 0) {
        logger.<span class="apidocCodeKeywordSpan">error</span>('Ignoring option '  + keyValue);
        return options;
    }
    options = options || {};
    var split = keyValue.split(':');
    options[split[0]] = split[1];
    return options;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.info" id="apidoc.element.mailin.logger.info">
        function <span class="apidocSignatureSpan">mailin.logger.</span>info
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">info = function (msg) {
  // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])
  var args = [level].concat(Array.prototype.slice.call(arguments));
  target.log.apply(target, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
.option('--smtp [value]', 'smtp options split with :, check https://github.com/andris9/smtp-server/tree/v1.4.0'
;, collectOptions, {});

/* Hack the argv object so that commander thinks that this script is called
 * 'mailin'. The help info will look nicer. */
process.argv[1] = 'mailin';
program.parse(process.argv);

logger.<span class="apidocCodeKeywordSpan">info</span>('Mailin v' + pkg.version);

var smtpOptions = program.smtp;
smtpOptions.disabledCommands = program.disabledSmtpCommands;

mailin.start({
port: program.port || 25,
host: program.host || '0.0.0.0',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.setLevel" id="apidoc.element.mailin.logger.setLevel">
        function <span class="apidocSignatureSpan">mailin.logger.</span>setLevel
        <span class="apidocSignatureSpan">(level)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setLevel = function (level) {
    if (['silly', 'verbose', 'debug', 'info', 'warn', 'error'].indexOf(level) === -1) {
        logger.error('Unable to set logging level to unknown level "' + level + '".');
    } else {
<span class="apidocCodeCommentSpan">        /* Verbose and debug have not exactly the same semantic in Mailin and
         * Winston, so handle that. */
</span>        if (logger.transports.console.level === 'verbose' &amp;&amp;
            level === 'debug') {
            return;
        }

        logger.transports.console.level = level;

        if (logger.transports.file) logger.transports.file.level = level;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/* Log to a file if necessary. */
if (configuration.logFile) {
    logger.setLogFile(configuration.logFile);
}

/* Set log level if necessary. */
if (configuration.logLevel) {
    logger.<span class="apidocCodeKeywordSpan">setLevel</span>(configuration.logLevel);
}

if (configuration.verbose) {
    logger.setLevel('verbose');
    logger.info('Log level set to verbose.');
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.setLogFile" id="apidoc.element.mailin.logger.setLogFile">
        function <span class="apidocSignatureSpan">mailin.logger.</span>setLogFile
        <span class="apidocSignatureSpan">(logFilePath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setLogFile = function (logFilePath) {
    this.add(winston.transports.File, {
        filename: logFilePath,
        json: false,
        maxsize: 20000000,
        timestamp: true
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/* Create tmp dir if necessary. */
if (!fs.existsSync(configuration.tmp)) {
    shell.mkdir('-p', configuration.tmp);
}

/* Log to a file if necessary. */
if (configuration.logFile) {
    logger.<span class="apidocCodeKeywordSpan">setLogFile</span>(configuration.logFile);
}

/* Set log level if necessary. */
if (configuration.logLevel) {
    logger.setLevel(configuration.logLevel);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.silly" id="apidoc.element.mailin.logger.silly">
        function <span class="apidocSignatureSpan">mailin.logger.</span>silly
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">silly = function (msg) {
  // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])
  var args = [level].concat(Array.prototype.slice.call(arguments));
  target.log.apply(target, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.verbose" id="apidoc.element.mailin.logger.verbose">
        function <span class="apidocSignatureSpan">mailin.logger.</span>verbose
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">verbose = function (msg) {
  // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])
  var args = [level].concat(Array.prototype.slice.call(arguments));
  target.log.apply(target, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }

    function validateDkim(connection, rawEmail) {
if (configuration.disableDkim) {
    return Promise.resolve(false);
}

logger.<span class="apidocCodeKeywordSpan">verbose</span>(connection.id + ' Validating dkim.');

return mailUtilities.validateDkimAsync(rawEmail)
    .catch(function (err) {
        logger.error(connection.id + ' Unable to validate dkim. Consider dkim as failed.');
        logger.error(err);
        return false;
    });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.logger.warn" id="apidoc.element.mailin.logger.warn">
        function <span class="apidocSignatureSpan">mailin.logger.</span>warn
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">warn = function (msg) {
  // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])
  var args = [level].concat(Array.prototype.slice.call(arguments));
  target.log.apply(target, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
logger.error('Please report this to ' + pkg.bugs.url);
logger.error(err);
logger.info();
logger.info();
});

mailinProcess.on('restart', function () {
logger.<span class="apidocCodeKeywordSpan">warn</span>('It is likely that an error caused Mailin to crash.');
logger.warn('Please report this to ' + pkg.bugs.url);
logger.warn('Mailin restarted.');

++restartCount;
logger.warn('Restart count: ' + restartCount);

logger.info();
...</pre></li>
    </ul>


























</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailin.mailUtilities" id="apidoc.module.mailin.mailUtilities">module mailin.mailUtilities</a></h1>


    <h2>
        <a href="#apidoc.element.mailin.mailUtilities.computeSpamScore" id="apidoc.element.mailin.mailUtilities.computeSpamScore">
        function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>computeSpamScore
        <span class="apidocSignatureSpan">(rawEmail, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">computeSpamScore = function (rawEmail, callback) {
    if (!isSpamcAvailable) {
        return callback(null, 0.0);
    }

    spamc.report(rawEmail, function (err, result) {
        logger.verbose(result);
        if (err) logger.error(err);
        if (err) return callback(new Error('Unable to compute spam score.'));
        callback(null, result.spamScore);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.mailUtilities.computeSpamScoreAsync" id="apidoc.element.mailin.mailUtilities.computeSpamScoreAsync">
        function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>computeSpamScoreAsync
        <span class="apidocSignatureSpan">(_arg0, _arg1, _arg2)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">computeSpamScoreAsync = function (_arg0, _arg1, _arg2) {
    'use strict';
    var len = arguments.length;
    var promise = new Promise(INTERNAL);
    promise._captureStackTrace();
    var nodeback = nodebackForPromise(promise);
    var ret;
    var callback = tryCatch(this != null ? this['computeSpamScore'] : fn);
    switch(len) {
        case 1:ret = callback.call(this, _arg0, nodeback); break;
case 0:ret = callback.call(this, nodeback); break;
case 2:ret = callback.call(this, _arg0, _arg1, nodeback); break;
case 3:ret = callback.call(this, _arg0, _arg1, _arg2, nodeback); break;

default:
    var args = new Array(len + 1);
    var i = 0;
    for (var i = 0; i &lt; len; ++i) {
       args[i] = arguments[i];
    }
    args[i] = nodeback;
    ret = callback.apply(this, args);

    break;

    }
    if (ret === errorObj) {
        promise._rejectCallback(maybeWrapAsError(ret.e), true, true);
    }
    return promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

function computeSpamScore(connection, rawEmail) {
    if (configuration.disableSpamScore) {
        return Promise.resolve(0.0);
    }

    return mailUtilities.<span class="apidocCodeKeywordSpan">computeSpamScoreAsync</span>(rawEmail)
        .catch(function (err) {
            logger.error(connection.id + ' Unable to compute spam score. Set spam score to 0.');
            logger.error(err);
            return 0.0;
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.mailUtilities.validateDkim" id="apidoc.element.mailin.mailUtilities.validateDkim">
        function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateDkim
        <span class="apidocSignatureSpan">(rawEmail, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validateDkim = function (rawEmail, callback) {
    if (!isPythonAvailable) {
        return callback(null, false);
    }

    var verifyDkimPath = path.join(__dirname, '../python/verifydkim.py');
    var verifyDkim = child_process.spawn('python', [verifyDkimPath]);

    verifyDkim.stdout.on('data', function (data) {
        logger.verbose(data.toString());
    });

    verifyDkim.on('close', function (code) {
        logger.verbose('closed with return code ' + code);
<span class="apidocCodeCommentSpan">        /* Convert return code to appropriate boolean. */
</span>        return callback(null, !!!code);
    });

    verifyDkim.stdin.write(rawEmail);
    verifyDkim.stdin.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.mailUtilities.validateDkimAsync" id="apidoc.element.mailin.mailUtilities.validateDkimAsync">
        function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateDkimAsync
        <span class="apidocSignatureSpan">(_arg0, _arg1, _arg2)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validateDkimAsync = function (_arg0, _arg1, _arg2) {
    'use strict';
    var len = arguments.length;
    var promise = new Promise(INTERNAL);
    promise._captureStackTrace();
    var nodeback = nodebackForPromise(promise);
    var ret;
    var callback = tryCatch(this != null ? this['validateDkim'] : fn);
    switch(len) {
        case 1:ret = callback.call(this, _arg0, nodeback); break;
case 0:ret = callback.call(this, nodeback); break;
case 2:ret = callback.call(this, _arg0, _arg1, nodeback); break;
case 3:ret = callback.call(this, _arg0, _arg1, _arg2, nodeback); break;

default:
    var args = new Array(len + 1);
    var i = 0;
    for (var i = 0; i &lt; len; ++i) {
       args[i] = arguments[i];
    }
    args[i] = nodeback;
    ret = callback.apply(this, args);

    break;

    }
    if (ret === errorObj) {
        promise._rejectCallback(maybeWrapAsError(ret.e), true, true);
    }
    return promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function validateDkim(connection, rawEmail) {
    if (configuration.disableDkim) {
        return Promise.resolve(false);
    }

    logger.verbose(connection.id + ' Validating dkim.');

    return mailUtilities.<span class="apidocCodeKeywordSpan">validateDkimAsync</span>(rawEmail)
        .catch(function (err) {
            logger.error(connection.id + ' Unable to validate dkim. Consider dkim as failed.');
            logger.error(err);
            return false;
        });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.mailUtilities.validateSpf" id="apidoc.element.mailin.mailUtilities.validateSpf">
        function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateSpf
        <span class="apidocSignatureSpan">(ip, address, host, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validateSpf = function (ip, address, host, callback) {
    if (!isPythonAvailable) {
        return callback(null, false);
    }

    var verifySpfPath = path.join(__dirname, '../python/verifyspf.py');
    var cmd = 'python ' + verifySpfPath + ' ' + ip + ' ' + address + ' ' + host;
    child_process.exec(cmd, function (err, stdout) {
        logger.verbose(stdout);
        var code = 0;
        if (err) {
            code = err.code;
        }

        logger.verbose('closed with return code ' + code);

<span class="apidocCodeCommentSpan">        /* Convert return code to appropriate boolean. */
</span>        return callback(null, !!!code);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailin.mailUtilities.validateSpfAsync" id="apidoc.element.mailin.mailUtilities.validateSpfAsync">
        function <span class="apidocSignatureSpan">mailin.mailUtilities.</span>validateSpfAsync
        <span class="apidocSignatureSpan">(_arg0, _arg1, _arg2)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validateSpfAsync = function (_arg0, _arg1, _arg2) {
    'use strict';
    var len = arguments.length;
    var promise = new Promise(INTERNAL);
    promise._captureStackTrace();
    var nodeback = nodebackForPromise(promise);
    var ret;
    var callback = tryCatch(this != null ? this['validateSpf'] : fn);
    switch(len) {
        case 3:ret = callback.call(this, _arg0, _arg1, _arg2, nodeback); break;
case 2:ret = callback.call(this, _arg0, _arg1, nodeback); break;
case 1:ret = callback.call(this, _arg0, nodeback); break;
case 0:ret = callback.call(this, nodeback); break;

default:
    var args = new Array(len + 1);
    var i = 0;
    for (var i = 0; i &lt; len; ++i) {
       args[i] = arguments[i];
    }
    args[i] = nodeback;
    ret = callback.apply(this, args);

    break;

    }
    if (ret === errorObj) {
        promise._rejectCallback(maybeWrapAsError(ret.e), true, true);
    }
    return promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function validateSpf(connection) {
    if (configuration.disableSpf) {
        return Promise.resolve(false);
    }

    logger.verbose(connection.id + ' Validating spf.');
    /* Get ip and host. */
    return mailUtilities.<span class="apidocCodeKeywordSpan">validateSpfAsync</span>(connection.remoteAddress, connection.from,
connection.clientHostname)
        .catch(function (err) {
            logger.error(connection.id + ' Unable to validate spf. Consider spf as failed.');
            logger.error(err);
            return false;
        });
}
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>